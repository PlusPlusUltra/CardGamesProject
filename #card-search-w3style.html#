<!DOCTYPE html>
<html>
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <body>

	<!-- top seach bar  -->
	<div class="w3-top">
	    <div class="w3-bar w3-orange w3-left-align w3-large">
		<a class="w3-bar-item w3-button w3-hover-brown" href="raw-scheme.html">schema</a>
		<a class="w3-bar-item w3-button w3-hover-brown" href="card-search.html">Card Search</a>
		<a class="w3-bar-item w3-button w3-hover-brown" href="sampleBuilder.html">Deck Builder</a>
		<input class="ui-autocomplete-input" autocomplete="off" type="text" id="name" onclick="this.select()"  onKeyDown="if(event.keyCode==13) loadDoc();">
	    </div>
	</div>


	<!-- centered element in the page  -->
	<div>
	    card: 
	    <button type="button" onclick="loadDoc()">Search</button>
	    <button type = "button" onclick="addCard()">Add to deck</button>
	    <button type = "button" onclick="removeLastCard()">Remove last</button>
	    
	    
	    <ul>
		<li><p id="card-img">card image</p></li>
		<li><p id="card-desc">card description tab</p></li>
		<li><p id="list">deck</p></li>
		<li><p id= "msg">other fancy messages</p></li>
		
	    </ul>
	</div>

	<script>
	 function loadDoc() {
	     
	     var xhttp = new XMLHttpRequest();
	     xhttp.onreadystatechange = function() {
		 
		 if (this.readyState == 4 && this.status == 200) {

		     if(this.responseText.indexOf("No card matching your query was found in the database") == -1){
			 
			 var myObj = JSON.parse(this.responseText)[0];
			 lastCard = myObj;

			 img_txt = "<img src='https://ygoprodeck.com/pics/"+myObj.id + ".jpg'>";
			 desc_txt= "<table border='1'>"+ 
				   "<tr><td>name</td><td>"+myObj.name+"</td></tr>"+
				   "<tr><td>card type</td><td>"+myObj.type+"</td></tr>"+
				   "<tr><td>text</td><td>"+myObj.desc+ "</td></tr>"+
				   "<tr><td>archetype</td><td>"+myObj.archetype+"</td></tr>"+
				   "</table>";

			 document.getElementById("card-img").innerHTML = img_txt;
			 document.getElementById("card-desc").innerHTML = desc_txt;
		     }else{
			 document.getElementById("card-desc").innerHTML = "No card matching your query was found in the database";
		     }
		 }
	     }
	     xhttp.open("GET", "https://db.ygoprodeck.com/api/cardinfo.php?name="+document.getElementById("name").value, true);
	     xhttp.send();
	 }







	 
	 //deckbuilder code
	 var cards = [];
	 function refreshDeck(){
	     var txt = "<table border='1'>";
	     for(i=0; i< cards.length; i++){
		 txt = txt + "<tr><td>"+ cards[i].name+"</td> " +
		       " <td><button type='button' onclick ='removeNumber(" + i + ")' id ='N" +
		       i + "'>X</button></td></tr>";
	     }
	     txt = txt + "</table>";
	     document.getElementById("list").innerHTML = txt;
	     document.getElementById("msg").innerHTML = "";
	     if (cards.length >= 40) document.getElementById("msg").innerHTML = "your deck is ready, time to d-d-d-d-d-d-d-d-d-d-d--d-d-duel";
	 }
	 function addCard(){
	     
	     if (!check60())
	     {
		 document.getElementById("msg").innerHTML = "you can't have more than 60 cards in your deck";
	     }
	     else if(!checkDuplicates())
	     {
		 document.getElementById("msg").innerHTML = "too many copies of a " + lastCard.ban_tcg + " card";

	     }
	     else{
		 //   document.getElementById("msg").innerHTML = "";
		 cards.push(lastCard);
		 refreshDeck();
		 //if (cards.length >= 40) document.getElementById("msg").innerHTML = "your deck is ready, time to d-d-d-d-d-d-d-d-d-d-d--d-d-duel";
	     }
	 }
	 function removeLastCard(){
	     cards.pop();
	     refreshDeck();
	     //document.getElementById("msg").innerHTML = "";

	 }
	 function removeNumber(n)
	 {
	     cards.splice(n,1);
	     refreshDeck();
	     //document.getElementById("msg").innerHTML = "";
	     //if (cards.length >= 40) document.getElementById("msg").innerHTML = "your deck is ready, time to d-d-d-d-d-d-d-d-d-d-d--d-d-duel";
	 }
	 function checkDuplicates(){ //checks if there are 3 copies of a card already
	     var count = 0;
	     var limit = 0;
	     
	     if (lastCard.ban_tcg == "Limited") limit = 1;
	     else if (lastCard.ban_tcg == "Semi-Limited") limit = 2;
	     else if (lastCard.ban_tcg == "Banned") limit = 0;
	     else limit = 3;
	     for(i = 0; i< cards.length; i++){
		 if (cards[i].name == lastCard.name) count ++;
	     }
	     if (count < limit) return true;
	     else return false;
	 }
	 function check60(){
	     if (cards.length >= 60) return false;
	     else return true;
	 }
	 
	</script>

    </body>
</html>
