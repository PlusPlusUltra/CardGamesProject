<!DOCTYPE html>
<html>
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <body>
	<form id="myForm"></form>
	<!-- top seach bar  -->
	<div class="w3-top">
	    <div class="w3-bar w3-orange w3-left-align">
		<a class="w3-bar-item w3-button w3-hover-brown" href="raw-scheme.html">schema</a>
		<a class="w3-bar-item w3-button w3-hover-brown" href="card-search.html">Card Search</a>
		<a class="w3-bar-item w3-button w3-hover-brown" href="sampleBuilder.html">Deck Builder</a>
		<input class="ui-autocomplete-input" list="card-list" autocomplete="off" type="text" id="name" onclick="this.select()" placeholder="Input a card name" onKeyDown="if(event.keyCode==13) loadDoc();">
		<div class="w3-dropdown-hover w3-right">
		    <button class="w3-button w3-brown w3-hover-orange">Card OPS</button>
		    <div class="w3-dropdown-content w3-bar-block w3-orange" style="right:0">
			<button type = "button" class="w3-bar-item w3-button w3-hover-brown"  onclick="autocompleteDb()">update local DB</button>
			<button type = "button" class="w3-bar-item w3-button w3-hover-brown"  onclick="addCard()">Add to deck</button>
			<button type = "button" class="w3-bar-item w3-button w3-hover-brown"  onclick="removeLastCard()">Remove last</button>
			
		    </div>
		</div>
	    </div>
	</div>


	<!-- centered element in the page  -->
	<div class="w3-row-padding w3-padding-64 w3-container">
	    <div class="w3-content-card">
		<div class="w3-half w3-center">
		    <div id="card-img">card image</div>
		</div>
		<div class="w3-third w3-center">
		    <div id="card-desc">card description tab </div>
		</div>
	    </div>
	</div>
	<div class="w3-row-padding w3-padding-64 w3-container">
	    <div class="w3-content-card">
		<div class="w3-third w3-center">
		    <p id="list">deck</p>
		    <p id= "msg">other fancy messages</p>
		</div>

	    </div>
	</div>

	<script>

	 //card search and display code ############
	 function loadDoc() {
	     
	     var xhttp = new XMLHttpRequest();
	     xhttp.onreadystatechange = function() {
		 
		 if (this.readyState == 4 && this.status == 200) {

		     if(this.responseText.indexOf("No card matching your query was found in the database") == -1){
			 
			 var myObj = JSON.parse(this.responseText)[0];
			 lastCard = myObj;

			 img_txt = "<img src='https://ygoprodeck.com/pics/"+myObj.id + ".jpg'>";
			 desc_txt= "<table border='1'>"+ 
				   "<tr><td>name</td><td>"+myObj.name+"</td></tr>"+
				   "<tr><td>card type</td><td>"+myObj.type+"</td></tr>"+
				   "<tr><td>text</td><td>"+myObj.desc+ "</td></tr>"+
				   "<tr><td>archetype</td><td>"+myObj.archetype+"</td></tr>"+
				   "</table>";

			 document.getElementById("card-img").innerHTML = img_txt;
			 document.getElementById("card-desc").innerHTML = desc_txt;
		     }else{
			 document.getElementById("card-desc").innerHTML = "No card matching your query was found in the database";
		     }
		 }
	     }
	     xhttp.open("GET", "https://db.ygoprodeck.com/api/cardinfo.php?name="+document.getElementById("name").value, true);
	     xhttp.send();
	 }

	 //autocomplete chache database code ############
	 function autocompleteDb(){
	     var xhttp = new XMLHttpRequest();
	     xhttp.onreadystatechange = function() {
		 if (this.readyState == 4 && this.status == 200) {
		     
		     var myBigObj = JSON.parse(this.responseText)[0];
		     
		     var y = document.createElement("DATALIST");
		     y.setAttribute("id", "card-list");
		     document.getElementById("myForm").appendChild(y);
		     
		     
		     for (x in myBigObj){
			 var z = document.createElement("OPTION");
			 z.setAttribute("value", myBigObj[x].name);
			 document.getElementById("card-list").appendChild(z);
		     }
		 }
	     }
	     xhttp.open("GET", "https://db.ygoprodeck.com/api/allcards.php", true);
	     xhttp.send();
	 }


	 
	 //deckbuilder code ############
	 var cards = [];
	 function refreshDeck(){
	     var txt = "<table border='1'>";
	     for(i=0; i< cards.length; i++){
		 txt = txt + "<tr><td>"+ cards[i].name+"</td> " +
		       " <td><button type='button' onclick ='removeNumber(" + i + ")' id ='N" +
		       i + "'>X</button></td></tr>";
	     }
	     txt = txt + "</table>";
	     document.getElementById("list").innerHTML = txt;
	     document.getElementById("msg").innerHTML = "";
	     if (cards.length >= 40) document.getElementById("msg").innerHTML = "your deck is ready, time to d-d-d-d-d-d-d-d-d-d-d--d-d-duel";
	 }
	 function addCard(){
	     
	     if (!check60())
	     {
		 document.getElementById("msg").innerHTML = "you can't have more than 60 cards in your deck";
	     }
	     else if(!checkDuplicates())
	     {
		 document.getElementById("msg").innerHTML = "too many copies of a " + lastCard.ban_tcg + " card";

	     }
	     else{
		 //   document.getElementById("msg").innerHTML = "";
		 cards.push(lastCard);
		 refreshDeck();
		 //if (cards.length >= 40) document.getElementById("msg").innerHTML = "your deck is ready, time to d-d-d-d-d-d-d-d-d-d-d--d-d-duel";
	     }
	 }
	 function removeLastCard(){
	     cards.pop();
	     refreshDeck();
	     //document.getElementById("msg").innerHTML = "";

	 }
	 function removeNumber(n)
	 {
	     cards.splice(n,1);
	     refreshDeck();
	     //document.getElementById("msg").innerHTML = "";
	     //if (cards.length >= 40) document.getElementById("msg").innerHTML = "your deck is ready, time to d-d-d-d-d-d-d-d-d-d-d--d-d-duel";
	 }
	 function checkDuplicates(){ //checks if there are 3 copies of a card already
	     var count = 0;
	     var limit = 0;
	     
	     if (lastCard.ban_tcg == "Limited") limit = 1;
	     else if (lastCard.ban_tcg == "Semi-Limited") limit = 2;
	     else if (lastCard.ban_tcg == "Banned") limit = 0;
	     else limit = 3;
	     for(i = 0; i< cards.length; i++){
		 if (cards[i].name == lastCard.name) count ++;
	     }
	     if (count < limit) return true;
	     else return false;
	 }
	 function check60(){
	     if (cards.length >= 60) return false;
	     else return true;
	 }
	 
	</script>

    </body>
</html>
